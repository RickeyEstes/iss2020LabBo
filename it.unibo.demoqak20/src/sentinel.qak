System sentinel
 	//"tcp://mqtt.eclipse.org:1883"
	//mqtt.eclipse.org
	//tcp://test.mosquitto.org
	//mqtt.fluux.io
	//"tcp://broker.hivemq.com" 
//mqttBroker "broker.hivemq.com" : 1883
 
Event   alarm : alarm(V)

Context ctxsentinel ip [host="localhost" port=8055]
   
QActor sentinel context ctxsentinel{
[# var counter=0 #]
	State s0 initial { 	
		//println("sentinel | STARTS")	 
		//[# sysUtil.trace=true #]		
 	} 
 	Goto watch if [# counter==0 #] else end
 	
 	State watch{
 		println("sentinel | WATCH")
 	}	
 	Transition t0  
 			whenEvent alarm and "counter==0" -> handleAlarm
 	 
 	State timeout{
   		printCurrentMessage
  		println("sentinel | TIMEOUT")	
  		//["counter++"]	
 	}
 	Goto s0
 	 
 	State handleAlarm{
  		printCurrentMessage
  		onMsg ( alarm : alarm(V) ) {
  			println("sentinel | ALARM ${payloadArg(0)} ")  // 
  		} 
  		delay 600
   	}
 	Transition t0 whenTime 400  -> explore  
 			//if another alarm (tsunami) arrives before 1 sec, it will be lost
 			//if the alarm (tsunami)  occurs after 1 sec, it can be sensed
 	//Goto watch		//the sentinel is able to perceive the next alarm
   	
 	State explore{
 		println("sentinel | exploring ...")
 	}
 	Goto watch
 	//Transition t0 whenTime 1000   -> watch
 	
 	State end{
 		println("sentinel | ENDS")	
 		terminate 0
 	}
 }

/* 
 * For local test
 */
 
QActor watcher context ctxsentinel{
	State s0 initial { 	
 		 println("			watcher emits fire")
		 emit alarm : alarm( fire )  
		 delay 500 
 		 println("			watcher emits tsunami")
		 emit alarm : alarm( tsunami )	 
		 
//		 delay 1000
//		 terminate 0 
	}
	
}
 /* */