<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
 
<style type="text/css">
body
{
    margin-left:  30px;
    margin-right: 30px;
};

P
{
    font-family: Tahoma;
    font-size: 10pt;
};

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
}

a:hover {
    background-color: #cccccc;
}


hr {
    clear: both;
    height: 1px;
    color: #242424;
    background-color: transparent;
}

h1, h2, h3 {
    color: #242424;
    clear: left;
    font: 100% Tahoma, Helvetica, Arial, sans-serif;
    margin-bottom: 0.5em;
    padding-top: 0.5em;
	border-radius: 10px;
	padding: 5px;
}

top {
	width: 100%;
}


#i {
    color: #ff1010;
}
tt{
	font-family: "Arial";
    font-size: 80%;
	color: #006600;
}
em{
	font-family: "Arial";
    font-size: 80%;
	font-weight: bold;
	border-style:solid;
	border-color: #abe876;
    color: #1632cc;
}
bc{
	font-family: "Arial";
	font-size: 80%;
	font-weight: bold;
    color: #990000;
	background-color: #fcf8c7;
}
ks{
	font-family: "Arial";
	font-weight: bold;
    color: #0000CD	;
	 
}
kc{
	font-family: "Arial";
	font-weight: bold;
    color: #008000	;
	 
}
pre{
	font-family: 8"Consolas";
	font-size: 90%;
	background-color: #f5f5f5;
	border: 1.0px solid silver;
	padding: 2px;
}
m{
	font-family: "Helvetica";
	line-height: 100%;
 	font-size: 75%;
}
div.body{
	width: 700px;
    font-size: 15px;
}
k{
    color: #990000;
	font-weight: bold;
}
h1 {
    font-size: 150%;
    background-color: #b2c0ff;
	padding: 10px; 
}

h2 {
    background-color: #9ed8ff;
    font-size: 130%;
}

h3 {
	background-color: #e6ccff;
    font-size: 100%;
}
h4 {
    background-color: #C0F0E0;
    font-size: 100%;
	width: 95%;
	border-radius: 5px;
	padding: 2px;
}
h5 {
    background-color: #d5ffb0;
    font-size: 100%;
	
}    
div.req{
	background-color: #d9ffb3;
    font-size: 18px;
	width: 700px;
    border: 3px solid green;
    padding: 15px;
    margin: 10px;
}       
div.remark{
	background-color: #E3F2FD;	
    border: 1.5px solid #d5f2ed;
    padding: 15px;
    margin: 10px;
	border-radius: 25px;
}  
table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
} 

ol, ul, li {
  margin: 0;
  margin-left: 10px;
  padding: 0;
  padding-bottom: 5px;
}     

table, th, td {
	border: 1px solid black;
}

img {
	border: 1.5px solid #d5f2ed
	
}

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
}

div.wrapdesc{
	width: 90%;
	margin: auto;
}

div.imagedesc{
	width: 85%;
	margin: auto;
}
</style>
    
<head>
   
<title>Webfluxintro</title></head>
    
<body>
<div id="body">
<h1>LabSpringIntro  | Introduction to 
<a href="https://docs.spring.io/spring-framework/docs/5.0.0.BUILD-SNAPSHOT/spring-framework-reference/html/web-reactive.html" target="web">
WebFlux </a></h1>
<!--
<h2>References</h2>
<ul>
<li><a href="https://dev-itel.atlassian.net/wiki/spaces/NEXTAGORA/overview" target="web">Confluence space: Nextagora</a> </li>
<li><a href="https://dev-itel.atlassian.net/wiki/spaces/UNIBO/overview" target="web">Confluence space: UNIBO</a> </li>
<li><a href="https://bitbucket.org/itelunibo/workspace/projects/" target="web">Projects on bitbucket</a> </li>
<li><a href="https://bitbucket.org/itelunibo/overviewrepo/src/master/it.unibo.itel/userDocs/3-LogicalArch/HDA_Disi.html" target="web">HDA_Disi.html (overviewrepo)</a> </li>
<hr/>

</ul>
 
<ul>
<li><a href="http://htmlpreview.github.com/?https://github.com/anatali/natmaterial/blob/master/health/userDocs/HealthReferences.html" target="web"> 
DISI - HealthReferences.html</a> (on <tt>natmaterial .... health/userDocs/</tt>) </li>
<li><a href="http://htmlpreview.github.com/?https://github.com/anatali/natmaterial/blob/master/health/userDocs/HealthReferences.html" target="web">DISI - HealthReferences.html </a></li>
 <li><a href="./MirthIntro.html" target="web"> 
DISI - MirthIntro.html</a> (on <tt>natMicroservices .... it.unibo.mirth.java/userDocs/MirthExperiments.html/</tt>) </li>
<li><a href="http://htmlpreview.github.com/?https://github.com/anatali/natmaterial/blob/master/it.unibo.hapi2.2/userDocs/HapiUsage.html" target="web"> 
DISI - HapiUsage.html</a> (on <tt>natMicroservices .... it.unibo.hapi2.2/userDocs/</tt>) </li>
<li><a href="http://htmlpreview.github.com/?https://github.com/anatali/natmaterial/blob/master/it.unibo.mirth.java/userDocs/HapiFhirUsage.html" target="web"> 
DISI - HapiFhirUsage.html</a> (on <tt>natMicroservices .... it.unibo.mirth.java/userDocs/</tt>) </li>
</ul>
 
 -->

<!-- http://192.168.1.244/debug/clip.html -->

<div class="remark">  
<a href="https://docs.spring.io/spring-framework/docs/5.0.0.BUILD-SNAPSHOT/spring-framework-reference/html/" 
target="web">Spring Framework Reference Documentation</a> (5.0.0.BUILD-SNAPSHOT)<br/>
<a href="https://docs.spring.io/spring-framework/docs/5.0.0.BUILD-SNAPSHOT/spring-framework-reference/html/web-reactive.html" 
target="web">23. WebFlux framework</a><br/>

<hr/>
See also:
 <a href="http://htmlpreview.github.com/?https://github.com/anatali/iss2020LabBo/blob/master/webspring.intro/userDocs/LabSpringIntro.html" target="web">  
LabSpringIntro | Introduction to Spring Boot</a> 
<!--
<a href="https://spring.io/projects/spring-boot" target="web">Spring Boot 2.3.2</a><br/>
<a href="https://www.tutorialspoint.com/spring_boot/index.htm" target="web">Spring Boot Tutorial</a><br/>
<a href="https://www.vogella.com/tutorials/SpringBoot/article.html" target="web">Spring Boot Tutorial (Vogella)</a><br/>
<a href="https://www.tutorialspoint.com/spring_boot/spring_boot_introduction.htm" target="web">Spring Boot - Introduction</a>
(TutorialsPoint: <i>Micro Service, Auto Configuration, Application, Component Scan</i>)<br/>
-->
</div> 


<h2>About Reactor</h2>

<ul>
<li><a href="https://projectreactor.io/docs/core/release/api/overview-summary.html" target="web">Reactor Core library 3.3.8 API </a></li>

<hr/>

<li><a href="https://projectreactor.io/docs/core/release/reference/index.html" target="web">Reactor 3 Reference Guide (<ks>R3RFG</ks>)</a></li>
<li><a href="https://projectreactor.io/docs/core/release/reference/index.html#intro-reactive" target="web">
<ks>R3RFG  | 3.</ks> Introduction to Reactive Programming</a> 
(<i>Iterable, Asynchronicity, Callbacks, Futures, CompletableFuture, Backpressure, Operators, Hot vs Cold</i>)</li>
<li><a href="https://projectreactor.io/docs/core/release/reference/index.html#intro-reactive" target="web">
<ks>R3RFG  | 4.</ks> Reactor Core Features</a> 
(<i>Publisher, Flux, Mono,  subscribe, Disposable, BaseSubscriber, ...</i>)</li>

<li><a href="https://projectreactor.io/docs/core/release/reference/#producing" target="web">
<ks>R3RFG  | 4.4.</ks> Programmatically creating a sequence</a>
(<i>generate, create, push, handle, concurrency-agnostic, Scheduler, publishOn, subscribeOn, onError, retry, Handling Exceptions,
Processor, Sink, Available Processors (Direct,Unicast,Emitter,Replay)</i>)</li>

<li><a href="https://projectreactor.io/docs/core/release/reference/#producing" target="web">
<ks>R3RFG  | 4.5.</ks> Threading and Schedulers</a>
(<i>concurrency-agnostic, Scheduler, publishOn, subscribeOn, )</i>)</li>

<li><a href="https://projectreactor.io/docs/core/release/reference/#producing" target="web">
<ks>R3RFG  | 4.6.</ks> Handling Errors</a>
(<i>onError, retry, Handling Exceptions </i>)</li>

<li><a href="https://projectreactor.io/docs/core/release/reference/#producing" target="web">
<ks>R3RFG  | 4.7.</ks> Processors</a>
(<i>Processor, Sink, Available Processors (Direct,Unicast,Emitter,Replay)</i>)</li>

<li><a href="https://projectreactor.io/docs/core/release/reference/index.html#reactor.hotCold" target="web">
<ks>R3RFG  | 9.2. </ks> Hot Versus Cold</a>
(<i>Processor, Sink, Available Processors (Direct,Unicast,Emitter,Replay)</i>)</li>




<hr/>
<li><a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html" target="web">
Class Flux&lt;T></a> (reactor-core 3.3.8.RELEASE)<br/>



 <li><a href="https://www.baeldung.com/spring-webflux" target="web">Guide to Spring 5 WebFlux</a> (Baeldung)<br/>
</li>
 <li><a href=" https://howtodoinjava.com/spring-webflux/spring-webflux-tutorial/" target="web">Spring WebFlux Tutorial</a> (HowToDoInJava)<br/>
 </li>
 

 <hr/>
 <h4>From <a href="https://spring.io/team/dsyer" target="web">Dave Syer</a> (<i>Founder of Spring Cloud, Spring Boot, ...</i>)</h4>
 <li><a href="https://spring.io/blog/2016/06/07/notes-on-reactive-programming-part-i-the-reactive-landscape" 
 target="web">Notes on Reactive Programming Part I: The Reactive Landscape</a>
</li>
 <li><a href="https://spring.io/blog/2016/06/13/notes-on-reactive-programming-part-ii-writing-some-code" 
 target="web">Notes on Reactive Programming Part II: Writing Some Code</a>
</li>
<li><a href="https://spring.io/blog/2016/07/20/notes-on-reactive-programming-part-iii-a-simple-http-server-application" 
 target="web">Notes on Reactive Programming Part III: A Simple HTTP Server Application</a>

</li>
<hr/>
<li><a href="https://www.influxdata.com/blog/use-flux-to-group-shape-and-analyze-your-time-series-data/" 
 target="web">Use Flux to Group, Shape, and Analyze Your Time Series Data</a></li>
 <li>
 <a href="https://docs.influxdata.com/flux/v0.7/introduction/getting-started" 
 target="web">InfluxDataâ€™s new functional data scripting language</a>

 </li>
 <hr/>
 <li><a href="https://www.nurkiewicz.com/2019/02/rxjava-vs-reactor.html" target="web">RxJava vs Reactor</a></li>
<li><a href="https://spring.io/blog/2019/10/15/simple-event-driven-microservices-with-spring-cloud-stream" 
target="web">Simple Event Driven Microservices with Spring Cloud Stream</a></li>
 
</ul>

<h3>About webFlux</h3>
From <a href="https://docs.spring.io/spring-framework/docs/5.0.0.BUILD-SNAPSHOT/spring-framework-reference/html/web-reactive.html" 
target="web">23. WebFlux framework</a> we read:<br/><br/>
<ul>
<li>Spring Framework 5 includes a new <k>spring-webflux</k> module. 
The module contains support for reactive HTTP and WebSocket clients as well as for reactive server web applications including 
REST, HTML browser, and WebSocket style interactions.<br/><br/>
</li>
<li>On the server-side WebFlux supports 2 distinct programming models:
	<ul>
	<li>Annotation-based with @Controller and the other annotations supported also with Spring MVC</li>
	<li>Functional, Java 8 lambda style routing and handling (see
	<a href="https://docs.spring.io/spring-framework/docs/5.0.0.BUILD-SNAPSHOT/spring-framework-reference/html/web-reactive.html#_routerfunctions"
	target="web"><em>RouterFunctions</em></a>)
	</li>
	</ul>
</li>

<li>The same <k>@Controller</k> programming model and the same annotations used in Spring MVC are also supported in WebFlux. 
The main difference is that the underlying core, framework contracts, i.e. <tt>HandlerMapping, HandlerAdapter</tt>, 
are non-blocking and operate on the reactive <tt>ServerHttpRequest</tt> and <tt>ServerHttpResponse</tt> rather than on the 
<tt>HttpServletRequest</tt> and <tt>HttpServletResponse</tt>.
<br/><br/></li>

<li>Incoming HTTP requests are handled by a HandlerFunction, which is essentially a function that takes a <tt>ServerRequest</tt> 
and returns a <k>Mono&lt;ServerResponse></k>. 
The annotation counterpart to a handler function would be a method with <k>@RequestMapping</k>.</li>

<li>WebFlux includes a functional, reactive <k>WebClient</k> that offers a fully non-blocking and reactive alternative to the 
<tt>RestTemplate</tt> (see <a href="https://docs.spring.io/spring-framework/docs/5.0.0.BUILD-SNAPSHOT/spring-framework-reference/html/web-reactive.html#web-reactive-client"
	target="web"><em>Client Side</em></a>).<br/><br/></li>
	
<li>WebFlux includes reactive <a href="https://en.wikipedia.org/wiki/WebSocket" target="web"><k>WebSocket</k></a> 
 client and server support.
(see <a href="https://docs.spring.io/spring-framework/docs/5.0.0.BUILD-SNAPSHOT/spring-framework-reference/html/web-reactive.html#web-reactive-client"
	target="web"><em>web-reactive-websocket-support</em></a> and
	
<a href="https://howtodoinjava.com/spring-webflux/reactive-websockets/" target="web"><ks>Spring Boot WebFlux WebSocket Example</ks></a>,

<a href="https://www.baeldung.com/java-websockets" target="web"><ks>A Guide to the Java API for WebSocket</ks></a>
	
	
	).<br/><br/></li>
</ul>

<h3>Netty and Tomcat</h3>
<div class="remark">
WebFlux can run on Servlet containers with support for the Servlet 3.1 Non-Blocking IO API as well as on other 
async runtimes such as Netty and Undertow. 
</div>
Each runtime is adapted to a reactive ServerHttpRequest and ServerHttpResponse exposing the body of the request and response as 
Flux<DataBuffer>, rather than InputStream and OutputStream, with reactive backpressure. 
REST-style JSON and XML serialization and deserialization is supported on top as a Flux&lt;Object>, 
and so is HTML view rendering and Server-Sent Events.
<hr/>

Developers describe Netty as "Asynchronous event-driven network application framework". 
Netty is a NIO client server framework which enables quick and easy development of network applications such as protocol servers and clients. 
It greatly simplifies and streamlines network programming such as TCP and UDP socket server. 
<br/><br/>
On the other hand, Apache Tomcat is detailed as "An open source software implementation of the Java Servlet and 
JavaServer Pages technologies". 
Apache Tomcat powers numerous large-scale, mission-critical web applications across a diverse range of industries and organizations.
<br/><br/>
Netty belongs to "Concurrency Frameworks" category of the tech stack, 
while Apache Tomcat can be primarily classified under "Web Servers".
<br/><br/>
"High Performance" is the top reason why over 2 developers like Netty, while over 76 developers mention "Easy" 
as the leading cause for choosing Apache Tomcat.
<br/><br/>
Netty and Apache Tomcat are both open source tools. 
It seems that Netty with 19.9K GitHub stars and 9.05K forks on GitHub has more adoption than 
Apache Tomcat with 3.51K GitHub stars and 2.4K GitHub forks.
<br/><br/>
According to the StackShare community, Apache Tomcat has a broader approval, 
being mentioned in 566 company stacks & 432 developers stacks; compared to Netty, 
which is listed in 11 company stacks and 14 developer stacks.

<h3>About Hooks.onOperatorDebug</h3>
<li><a href="https://projectreactor.io/docs/core/release/reference/index.html#reactor.hotCold" target="web">
<ks>R3RFG  | 7.2. </ks> Activating Debug Mode - aka tracebacks</a> </li>

In reactor, <tt>Hooks.onOperatorDebug()</tt> instruments the Reactor operators to collect more information about 
the current stack during the execution. This has a performance cost, and should not be done in production. 
This is a static call that needs to be done only once per JVM execution, so no need to repeat it for every controller call. 
With Spring Boot, this is done automatically for you is you have the spring-boot-devtools dependency on classpath.
<br/><br/>
Since Spring Boot 2.1, you can get better logs for web-related operations by setting to DEBUG the web logging group, 
so <tt>logging.level.web=debug</tt>. This will log useful information about web requests processing.

<h3>About Spring events (to remove???)</h3>
<ul>
  <li><a href="https://reflectoring.io/spring-boot-application-events-explained/" target="web">
  Spring Boot Application Events Explained</a> (Tom Hombergs)</li>

<li><a href="https://www.baeldung.com/spring-events" target="web">Spring Events</a> (Baeldung)</li>
<li><a href="https://howtodoinjava.com/spring-core/how-to-publish-and-listen-application-events-in-spring/" 
target="web">Spring â€“ Application events</a> (HowToDoInJava)</li>
</ul>


<h2>Examples</h2> http://learning-spring-boot.cfapps.io/
<a href="https://projectreactor.io/docs/core/release/reference/index.html#core-features" target="web">
<ks>R3RFG | 4.</ks> Reactor Core Features</a><br/>
The Reactor project main artifact is reactor-core, a reactive library that focuses on the 
Reactive Streams specification and targets Java 8.

Reactor introduces composable reactive types that implement <tt>Publisher</tt> but also provide a rich vocabulary of operators: 
<tt>Flux</tt> and Mono</tt>. <br/><br/>
A <ks>Flux</ks> object represents a reactive sequence of <tt>0..N</tt> items, 
while a <ks>Mono</ks> object represents a single-value-or-empty <tt>(0..1)</tt> result.

<h3>Basics: Flux, Mono, subscribe</h3>
The examples are reported in <a href="../src/main/reactiveDemo/ReactorDemo.java" target="code">ReactorDemo.java</a>
<div class="remark">
Flux (and Mono) represent an asynchronous sequence of data, and <k>nothing happens before you subscribe</k>.
</div>
<table style="width:98%">
<tbody>	
<tr>
<td style="width:50%" >
<m><h4>Mono&lt;T></h4></m>
<pre>
public void demoMono() {
  Mono<String> mono1 = Mono.empty();
  Mono<String> mono2 = Mono.just("Bob");
  mono1.subscribe( item -> System.out.println("demoMono: " + item) );
  mono2.subscribe(  
	item  -> System.out.println("subscriber2 item=  " + item),
	error -> System.out.println("subscriber2 error= " + error ),
	()    -> System.out.println("subscriber2 done "   )
  }
}
</pre> 
</td>
<td>
<pre>
<kc>OUTPUT</kc>
subscriber2 item=  Bob
subscriber2 done
</pre>
<a href="https://projectreactor.io/docs/core/release/reference/index.html#mono" target="web"><ks>R3RFG</ks> Mono</a>:<br/>
<m>
<ul>
<li>A Mono&lt;T> is a specialized <tt>Publisher&lt;T></tt> that emits at most one item and then (optionally) terminates with an 
<ks>onComplete</ks> signal or an <ks>onError</ks> signal.</li>
</ul>
</m>
</td>
</tr>

<tr>
<td >
<m><h4>Flux&lt;T></h4></m>
<pre>
public void demoFlux() {
  int n = 0;
  Flux<String> flux1 = Flux.just("A"+ n++, "B" + n++ );
  Flux<String> flux2 = Flux.fromArray(new String[]{"A"+ n++, "B" + n++ );
  Flux<String> flux3 = Flux.fromIterable(Arrays.asList("A"+ n++, "B" + n++ );
  flux1.subscribe( item -> System.out.println("demoFlux - 1: " + item) );
  flux1.subscribe( item -> System.out.println("demoFlux - 1: " + item) );
  flux2.subscribe( item -> System.out.println("demoFlux - 2: " + item) );
  flux3.subscribe( 
	item  -> System.out.println("demoFlux - 3 item=  " + item),
	error -> System.out.println("demoFlux - 3 error= " + error ),
	()    -> System.out.println("demoFlux - 3 done "   )	
  );
  
}
</pre><m></m>
</td>
<td>
<pre>
<m><kc>OUTPUT</kc>
demoFlux - 1: A0
demoFlux - 1: B1
demoFlux - 1: A0
demoFlux - 1: B1
demoFlux - 2: A2
demoFlux - 2: B3
demoFlux - 3 item=  A4
demoFlux - 3 item=  B5
demoFlux - 3 done</m>
</pre>
<a href="https://projectreactor.io/docs/core/release/reference/index.html#flux" target="web"><ks>R3RFG</ks> Flux</a>:<br/> 
<m>
<ul>
<li>A Flux&lt;T> is a standard  <tt>Publisher&lt;T></tt> that represents an asynchronous sequence of 0 to N emitted items,
optionally terminated by either <ks>onComplete</ks> signal or an <ks>onError</ks> signal.</li>
</ul>
</m>
<a href="https://projectreactor.io/docs/core/release/reference/index.html#reactor.hotCold" target="web">
<ks>R3RFG | 9.2.</ks>  Hot Versus Cold</a>:<br/> 
<m>
<ul>
<li><em>just</em> is an example of the few hot operators in Reactor. 
It directly captures the value at <i>assembly time</i> and replays it to anybody subscribing to it later. </li>
</ul>
</m>
</td>
</tr>

<tr>
<td><m><h4>User-defined Subscriber </h4></m>
<pre>
Subscriber<Long> <ks>anobserver</ks> = <k>new Subscriber<Long>()</k> {<m><kc>//interface</kc></m>
  @Override
  public void onSubscribe(Subscription s) {
	s.request( 5 );  <m><kc>//0-4 only instead of Long.MAX_VALUE</kc></m>
  }
  @Override
  public void onNext(Long v) {
	System.out.println("subscriber2 - onNext: " + v );
  }
  @Override
  public void onError(Throwable t) {
	System.out.println("subscriber2 - onError " + t );
  }
  @Override
  public void onComplete() {
	System.out.println("subscriber2 - onComplete "  );
  }
};

 public void demoObserver() {		
	Flux<Long> data = Flux.just( 1L,2L,3L,4L,5L,6L,7L  );
	data.subscribe( <ks>anobserver</ks>  );
	data.subscribe( v -> System.out.println("v= " + v) );
 }
</pre>

</td>
<td>
<pre>
anobserver - onNext: 1
anobserver - onNext: 2
anobserver - onNext: 3
anobserver - onNext: 4
anobserver - onNext: 5
v= 1
v= 2
v= 3
v= 4
v= 5
v= 6
v= 7
</pre>
Interface <a href="https://www.reactive-streams.org/reactive-streams-1.0.3-javadoc/org/reactivestreams/Subscriber.html?is-external=true" target="web">
<ks>Subscriber&lt;T></a>:<br/> 

<m>
<ul>
<li>we define a subcriber working as an observer of at most 5 data</li>
</ul>
</m>
</td>
</tr>


<tr>
<td><m><h4>BaseSubscriber and Backpressure</h4></m>
<pre>
public void demoBackpressure() {
 CustomSubscriber&lt;String> sbscrb1 = new CustomSubscriber&lt;>("sbscrb1");
 Flux<String> source  = Flux.just("A","B","C","D" );
 source.subscribe( sbscrb1 );		
}

<m>
public class CustomSubscriber&lt;T> <k>extends BaseSubscriber&lt;T></k> { 
private String name="";
private int n = 0;	 
 public CustomSubscriber( String name ){
  this.name = name;
 }
 public void <k>hookOnSubscribe</k>(Subscription subscription) {
  <kc>//requested the first item on subscribe</kc>
  System.out.println(name+ " | hookOnSubscribe n=" + n);
  request(1);
 }    
 public void <k>hookOnNext</k>(T value) {
  n++;
  if( n > 2 ) {
	delay(1500);
	System.out.println(name + " | hookOnNext n=" + n + " dalayed value=" + value);	   
  }else System.out.println(name + " | hookOnNext n=" + n + " value=" + value);		  
	request(1);
  }   
 public void <k>hookOnComplete</k>() {
	System.out.println(name + " | hookOnComplete n=" + n  );		         	
 }
}
</m>
</pre>
</td>
<td><pre>
<m><kc>OUTPUT</kc>
sbscrb1 | hookOnSubscribe n=0
sbscrb1 | hookOnNext n=1 value=A
sbscrb1 | hookOnNext n=2 value=B
sbscrb1 | hookOnNext n=3 delayed value=C
sbscrb1 | hookOnNext n=4 delayed value=D
sbscrb1 | hookOnComplete n=4
</pre>
<a href="https://projectreactor.io/docs/core/release/reference/index.html#reactor.hotCold" target="web">
<ks>R3RFG | 4.3.3.</ks>  An Alternative to Lambdas: BaseSubscriber</a>:<br/> 
<m>
<ul>
<li><em>BaseSubscriber</em> is the recommended abstract class for user-defined Subscribers in Reactor</li>
</ul>
</m>
<a href="https://projectreactor.io/docs/core/release/reference/index.html#_on_backpressure_and_ways_to_reshape_requests" target="web">
<ks>R3RFG | 4.3.4.</ks>  On Backpressure and Ways to Reshape Requests</a>:<br/> 
<m>
<ul>
<li>When implementing backpressure in Reactor, the way consumer pressure is propagated back to the source is 
by sending a <em>request</em> to the upstream operator. <br/>
The sum of current requests is sometimes referenced to as the current 'demand', or 'pending request'.</li>
</ul>
</m>

</td>
</tr>
 </tbody>
</table>
 
<h3>Generators</h3>
 
<td><h4>Synchronous generate</h4>
<table style="width:98%">
<tbody>	
<tr>
<td style="width:55%" >
<pre>
public void demoFluxGen0() {
  Flux<String> flux = Flux.generate(
	() -> 0, 			<kc>//initial state value</kc>
	(state, sink) -> {
	  <k>sink.next</k>("3 x " + state + " = " + 3*state); 
	  if (state == 5) <k>sink.complete()</k>; 
	  return state + 1; 	<kc>//a new state for the next invocation</kc>
	});	
  flux.subscribe( item -> System.out.println("demoFluxGen0 - 1: " + item) );
  flux.subscribe( item -> System.out.println("demoFluxGen0 - 2: " + item) );
}
</pre>
</td>
<td>
<pre>
<m><kc>OUTPUT</kc>
demoFluxGen0 - 1: 3 x 0 = 0
demoFluxGen0 - 1: 3 x 1 = 3
demoFluxGen0 - 1: 3 x 2 = 6
demoFluxGen0 - 1: 3 x 3 = 9
demoFluxGen0 - 1: 3 x 4 = 12
demoFluxGen0 - 1: 3 x 5 = 15
demoFluxGen0 - 2: 3 x 0 = 0
demoFluxGen0 - 2: 3 x 1 = 3
demoFluxGen0 - 2: 3 x 2 = 6
demoFluxGen0 - 2: 3 x 3 = 9
demoFluxGen0 - 2: 3 x 4 = 12
demoFluxGen0 - 2: 3 x 5 = 15
</pre>
<a href="https://projectreactor.io/docs/core/release/reference/index.html#producing" target="web">
<ks>R3RFG | 4.4.1.</ks>   Synchronous generate</a> (Example 4.11):<br/> 
 
the generate method takes a generator function.
</m>

</td>
</tr>

<tr>
<td>
<pre>
public void demoFluxGen1() {
  Flux<String> flux = Flux.generate(
	<k>(AtomicLong::new</k>, 	<kc>//a mutable object as the state</kc>
	(state, sink) -> {
	  long i = state.getAndIncrement();   <kc>//mutate the state</kc> 
	  sink.next</k>("3 x " + i + " = " + 3*i);
	  if (i == 5) sink.complete();
	  return <k>state</k>;  <kc>//return the same instance as the new state</kc>
	});	
  flux.subscribe( item -> System.out.println("demoFluxGen1 - 1: " + item) );
  flux.subscribe( item -> System.out.println("demoFluxGen1 - 2: " + item) );
}
</pre>
</td>
<td>
<pre>
<m><kc>OUTPUT</kc>
demoFluxGen1 - 1: 3 x 0 = 0
demoFluxGen1 - 1: 3 x 1 = 3
demoFluxGen1 - 1: 3 x 2 = 6
demoFluxGen1 - 1: 3 x 3 = 9
demoFluxGen1 - 1: 3 x 4 = 12
demoFluxGen1 - 1: 3 x 5 = 15
demoFluxGen1 - 2: 3 x 0 = 0
demoFluxGen1 - 2: 3 x 1 = 3
demoFluxGen1 - 2: 3 x 2 = 6
demoFluxGen1 - 2: 3 x 3 = 9
demoFluxGen1 - 2: 3 x 4 = 12
demoFluxGen1 - 2: 3 x 5 = 15
</pre>
<a href="https://projectreactor.io/docs/core/release/reference/index.html#producing" target="web">
<ks>R3RFG | 4.4.1.</ks>   Synchronous generate</a> (Example 4.12):<br/> 
 
using a single <ks>AtomicLong</ks> as the state, mutating it on each round.
</m>
</td>
</tr>

<tr>
<td>
<pre>
public void demoFluxGen2() {
  Flux<String> flux = Flux.generate(
	(AtomicLong::new, 	<kc>//a mutable object as the state</kc>
	(state, sink) -> {
	  long i = state.getAndIncrement();   <kc>//mutate the state</kc> 
	  sink.next("3 x " + i + " = " + 3*i);
	  if (i == 5) sink.complete();
	  return state;  <kc>//return the same instance as the new state</kc>
	})<k>, (state) -> System.out.println("state: " + state))</k>;	
  flux.subscribe( item -> System.out.println("demoFluxGen2 - 1: " + item) );
  flux.subscribe( item -> System.out.println("demoFluxGen2 - 2: " + item) );
}
</pre>
</td>
<td><pre>
<m><kc>OUTPUT</kc>
demoFluxGen2 - 1: 3 x 0 = 0
demoFluxGen2 - 1: 3 x 1 = 3
demoFluxGen2 - 1: 3 x 2 = 6
demoFluxGen2 - 1: 3 x 3 = 9
demoFluxGen2 - 1: 3 x 4 = 12
demoFluxGen2 - 1: 3 x 5 = 15
state: 6
demoFluxGen2 - 2: 3 x 0 = 0
demoFluxGen2 - 2: 3 x 1 = 3
demoFluxGen2 - 2: 3 x 2 = 6
demoFluxGen2 - 2: 3 x 3 = 9
demoFluxGen2 - 2: 3 x 4 = 12
demoFluxGen2 - 2: 3 x 5 = 15
state: 6
</pre>
<a href="https://projectreactor.io/docs/core/release/reference/index.html#producing" target="web">
<ks>R3RFG | 4.4.1.</ks>   Synchronous generate</a> (Example 4.12,  <k>with a consumer</k>):<br/> 
 
the <k>Consumer</k> lambda could close a connection or  handle any tasks that should be done at the end of the process.
</m>
</td>
</tr>
 
 </tbody>
</table>

<h4>Asynchronous create and push</h4>

See also <a href="https://www.baeldung.com/flux-sequences-reactor" target="web">
Programmatically Creating Sequences with Project Reactor (Baeldung) </a>

<br/><br/>

<table style="width:98%">
<tbody>	
<tr>
<td style="width:45%" >
<pre>
public void demoCreate0() {
  Flux<String> bridge = <k>Flux.create</k>(
	emitter -> { <m><kc>//emitter type= Consumer&lt;? super FluxSink&lt;String>></kc></m>
	  for (int i = 0; i < 3; i++) {
		emitter<k>.next</k>(String.valueOf(i));
	  }
  });
 bridge.subscribe(item -> System.out.println("demoCreate0 - 1: " + item));
 bridge.subscribe(item -> System.out.println("demoCreate0 - 2: " + item));
}

</pre>
</td>
<td><pre><m><kc>OUTPUT</kc>
demoFluxCreate0 - 1: 0
demoFluxCreate0 - 1: 1
demoFluxCreate0 - 1: 2
demoFluxCreate0 - 2: 0
demoFluxCreate0 - 2: 1
demoFluxCreate0 - 2: 2
</pre>
<a href="https://projectreactor.io/docs/core/release/reference/index.html#producing.create" target="web">
<ks>R3RFG | 4.4.2.</ks>  Asynchronous and Multi-threaded: create</a><br/>
 
<k>create</k> is a more advanced form of programmatic creation of a Flux which is suitable for  
multiple emissions per round, even from multiple threads.</m>

</td>
</tr>


<tr>
<td>
<pre>
public void demoPush0() {
 Flux<String> bridge = Flux.push(sink -> {
   new Thread() {
	int n = 0;
	public void run() {
	  while( n < 5 ) {
		sink.next("a" + n++);
		try {
			Thread.sleep(500);
		} catch (InterruptedException e) {
			e.printStackTrace();
		}
	  }//while
	  sink.complete();
	}//run
   }.start();		 
 });		
 bridge.subscribe( item -> System.out.println("demoPush0 - 1: " + item));
 bridge.subscribe( item -> System.out.println("demoPush0 - 2: " + item));
}
</pre>
</td>
<td><pre><m><kc>OUTPUT</kc>
demoPush0 - 1: a0
demoPush0 - 2: a0
demoPush0 - 1: a1
demoPush0 - 2: a1
demoPush0 - 2: a2
demoPush0 - 1: a2
demoPush0 - 2: a3
demoPush0 - 1: a3
demoPush0 - 2: a4
demoPush0 - 1: a4
</pre>
<a href="https://projectreactor.io/docs/core/release/reference/index.html#_asynchronous_but_single_threaded_push" target="web">
<ks>R3RFG | 4.4.3.</ks>   Asynchronous but single-threaded: push</a><br/>
<m>
<k>push</k> is a middle ground between generate and create which is suitable for processing events from a single producer
</m>
</td>
</tr>

<tr>
<td>
</td>
<td>
</td>
</tr>
 </tbody>
</table>

<h4>Hot publishers</h4>

<table style="width:98%">
<tbody>	
<tr>
<td style="width:45%" >
<pre>
public void demoHot0() {
 DirectProcessor&lt;String> hotSource = <k>DirectProcessor</k>.create();
 Flux<String> <ks>hotFlux</ks>   = hotSource.map(String::toUpperCase);

 <ks>hotFlux.subscribe</ks>(d -> System.out.println("Subscriber 1: "+d));

 hotSource<k>.onNext</k>("blue");
 hotSource<k>.onNext</k>("green");

 <ks>hotFlux.subscribe</ks>(d -> System.out.println("Subscriber 2: "+d));

 hotSource<k>.onNext</k>("orange");
 hotSource<k>.onNext</k>("purple");
 
 hotSource.<k>onComplete</k>();		
}

</pre>
</td>
<td><pre><m><kc>OUTPUT</kc>
Subscriber 1: BLUE
Subscriber 1: GREEN
Subscriber 1: ORANGE
Subscriber 2: ORANGE
Subscriber 1: PURPLE
Subscriber 2: PURPLE
</pre>
<a href="https://projectreactor.io/docs/core/release/reference/index.html#reactor.hotCold" target="web">
<ks>R3RFG | 9.2.</ks>  Hot Versus Cold</a><br/>
<m>
Hot publishers <k>do not depend on any number of subscribers</k>.<br/>
They might start publishing data right away and would continue doing so whenever a new Subscriber comes in 
(in which case, the subscriber would see only new elements emitted after it subscribed). 
<br/><br/>
For hot publishers, <k>something does indeed happen before you subscribe</k>.
</m>
</td>
</tr>

 </tbody>
</table>


<h4> </h4>

<table style="width:98%">
<tbody>	
<tr>
<td style="width:45%" >
<pre>
 </pre>
</td>
<td>
<a href="https://projectreactor.io/docs/core/release/reference/index.html#reactor.hotCold" target="web">
<ks>R3RFG | 9.2.</ks>  Hot Versus Cold</a><br/>
<m>
 </m>
</td>
</tr>

 </tbody>
</table>


<h3>Functional programming style</h3>

<table style="width:98%">
<tbody>	
<tr>
<td style="width:45%" >
<pre>
</pre>
</td>
<td>
</td>
</tr>

<tr>
<td>
</td>
<td>
</td>
</tr>
 </tbody>
</table>

 

 <br/><br/>

<table style="width:98%">
<tbody>	
<tr>
<td style="width:50%" >
<h3>...</h3>
<pre>
 </pre>
</td>
<td>
 <h3>Usage</h3>
 <div class="remark">
<center>
..</center>
</div> 
</td>
</tr>
 </tbody>
</table>
 <br/><br/>
 
 
 
  

 <br/><br/>
<table style="width:98%">
<tbody>	
<tr>
<td style="width:50%" >
</td>
<td>
</td>
</tr>
 </tbody>
</table>
 <br/><br/>
</div>  

 

<div style="background-color:rgba(86, 56, 253, 0.9); width:100%;text-align:center;font-size:small;color:white">
By AN Unibo-DISI  
</div> 

</body>
</html>


 